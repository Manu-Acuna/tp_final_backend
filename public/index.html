<!DOCTYPE html>
<html lang="es">
<head>
	<title>E-commerce - Inicio</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<link rel="stylesheet" href="css/styles.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" />
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Outfit:400,500,600,700,800,900&subset=latin" />
	<link rel="icon" type="image/png" sizes="48x48" href="./favicon.png" />
</head>

<body>
	<!-- Placeholder para el header reutilizable -->
    <div id="header-placeholder"></div>

	<!-- Placeholder para el carrito reutilizable -->
    <div id="cart-placeholder"></div>
	<main>
		<section class="carrusel">
            <div id="productCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
                <div class="carousel-indicators">
                  <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                  <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
                  <button type="button" data-bs-target="#productCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <img src="https://imagenes.compragamer.com/bannerPrincipal/DC_20251003172358_rJTbWwMS.jpg" class="d-block carousel-image-custom" alt="Producto 1">
                    </div>
                    <div class="carousel-item">
                        <img src="https://imagenes.compragamer.com/bannerPrincipal/DC_20251006135600_IY108xqx.jpg" class="d-block carousel-image-custom" alt="Producto 2">
                    </div>
                    <div class="carousel-item">
                        <img src="https://imagenes.compragamer.com/bannerPrincipal/DC_20251009174225_3JrGhCFq.jpg" class="d-block carousel-image-custom" alt="Producto 3">
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#productCarousel" data-bs-slide="prev">
                  <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Previous</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#productCarousel" data-bs-slide="next">
                  <span class="carousel-control-next-icon" aria-hidden="true"></span>
                  <span class="visually-hidden">Next</span>
                </button>
              </div>
        </section>
		<!-- Sección de Productos -->
		<section class="py-5">
			<div class="container">
				<div class="row">
					<!-- Columna de Filtros Fija -->
					<div class="col-lg-3">
						<div class="filters-sidebar">
							<h4 class="mb-4">Filtros</h4>
							<div class="accordion accordion-flush" id="accordionFlushExample">
								<!-- Categorias -->
								<div class="accordion-item">
									<h2 class="accordion-header">
										<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="false" aria-controls="panelsStayOpen-collapseOne">
											Categorias
										</button>
									</h2>
									<div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse px-4 py-2">
										<!-- Las categorías se cargarán aquí dinámicamente -->
										<div id="category-filters-container">
											<p class="text-muted small">Cargando...</p>
										</div>
									</div>
								</div>
								<!-- Marcas -->
								<div class="accordion-item">
									<h2 class="accordion-header">
										<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
											Marcas
										</button>
									</h2>
									<div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse px-4 py-2">
										<!-- Las marcas se cargarán aquí dinámicamente -->
										<div id="brand-filters-container">
											<p class="text-muted small">Cargando...</p>
										</div>
									</div>
								</div>
								<!-- Precio -->
								<div class="accordion-item">
									<h2 class="accordion-header">
										<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="false" aria-controls="panelsStayOpen-collapseThree">
											Precio
										</button>
									</h2>
									<div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse p-2">
										<div class="d-flex gap-2">
											<div class="input-group">
												<span class="input-group-text">$</span>
												<input type="text" class="form-control" aria-label="Precio minimo" placeholder="Minimo" id="minprice-input"> 
											</div>
											<div class="input-group">
												<span class="input-group-text">$</span>
												<input type="text" class="form-control" aria-label="Precio maximo" placeholder="Maximo" id="maxprice-input"> 
											</div>
										</div>
									</div>	
								</div>
							</div>
							<!-- Boton de aplicar filtros -->
							<div class="d-grid gap-2 mt-4">
								<button class="btn btn-primary" type="button" id="apply-filters-button" onclick="obtenerFiltros()">
									Aplicar Filtros
								</button>
								<button class="btn btn-secondary" type="button" id="clear-filters-button" onclick="limpiarFiltros()">
									Limpiar Filtros
								</button>
							</div>
						</div>
					</div>

					<!-- Columna de Productos -->
					<div class="col-lg-9">
						<div class="mb-5 text-center">
							<h2 class="font-heading fs-7">Nuestros Productos</h2>
							<p class="text-secondary-dark">Explora nuestro catálogo de productos</p>
						</div>
						<div id="product-grid" class="row g-4">
							<!-- Las tarjetas de productos se insertarán aquí con JavaScript -->
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="container">
			<div class="mb-5 text-center">
				<h2 class="font-heading fs-7">Nuestros Productos</h2>
				<p class="text-secondary-dark">Explora nuestro catálogo de productos</p>
			</div>

			<button class="btn btn-primary mb-4" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasScrolling" aria-controls="offcanvasScrolling">
				Filtros
			</button>

			<div id="product-grid" class="row g-6 m-0">
				<!-- Las tarjetas de productos se insertarán aquí con JavaScript -->
			</div>
		</div>
	</section>

	<!-- Placeholder para el footer reutilizable -->
    <div id="footer-placeholder"></div>

	<!-- Scripts -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
	<script src="js/header.js"></script>
	<script src="js/cart.js"></script>
	<script src="js/footer.js"></script>
	<script src="js/burguer-button.js"></script>
	<script src="js/logout.js"></script>
	<script src="js/api.js"></script>
	<script>
		document.addEventListener('DOMContentLoaded', function() {
			loadFilterOptions(); // Cargar categorías y marcas en los filtros
			// Comprueba si hay un término de búsqueda en la URL
			const urlParams = new URLSearchParams(window.location.search);
			const searchTerm = urlParams.get('search');
			

            if (categoryId) {
                // Si hay un ID de categoría, filtramos por él
                filtrarProductos({ categoryID: categoryId, selectedBrands: [], minPrice: null, maxPrice: null });
            } else {
                // De lo contrario, hacemos una búsqueda normal o cargamos todos
                fetchProducts(searchTerm || '');
            }
		});

		function limpiarFiltros() {
			// Limpia los inputs de radio, checkboxes y precios
			document.querySelectorAll('input[name="category"]').forEach(radio => radio.checked = false);
			document.querySelectorAll('#brand-filters-container input[type="checkbox"]').forEach(checkbox => checkbox.checked = false);
			document.getElementById('minprice-input').value = '';
			document.getElementById('maxprice-input').value = '';
			fetchProducts(); // Vuelve a cargar todos los productos
		}
	</script>
</body>
</html>
