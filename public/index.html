<!DOCTYPE html>
<html lang="es">

<head>
	<title>E-commerce - Inicio</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&amp;display=swap" />
	<link rel="stylesheet"
		href="https://fonts.googleapis.com/css?family=Outfit:400,500,600,700,800,900&amp;subset=latin" />
	<link rel="stylesheet" href="css/styles.css">
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
		crossorigin="anonymous"></script>
	<link rel="icon" type="image/png" sizes="48x48" href="./favicon.png" />
</head>

<body>
	<!-- Placeholder para el header reutilizable -->
	<div id="header-placeholder"></div>

	<!-- Placeholder para el carrito reutilizable -->
	<div id="cart-placeholder"></div>
	<main>
		<section class="carrusel">
			<div id="productCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="5000">
				<div class="carousel-indicators">
					<button type="button" data-bs-target="#productCarousel" data-bs-slide-to="0" class="active"
						aria-current="true" aria-label="Slide 1"></button>
					<button type="button" data-bs-target="#productCarousel" data-bs-slide-to="1"
						aria-label="Slide 2"></button>
					<button type="button" data-bs-target="#productCarousel" data-bs-slide-to="2"
						aria-label="Slide 3"></button>
				</div>
				<div class="carousel-inner">
					<div class="carousel-item active">
						<img src="https://imagenes.compragamer.com/bannerPrincipal/DC_20251003172358_rJTbWwMS.jpg"
							class="d-block carousel-image-custom" alt="Producto 1">
					</div>
					<div class="carousel-item">
						<img src="https://imagenes.compragamer.com/bannerPrincipal/DC_20251006135600_IY108xqx.jpg"
							class="d-block carousel-image-custom" alt="Producto 2">
					</div>
					<div class="carousel-item">
						<img src="https://imagenes.compragamer.com/bannerPrincipal/DC_20251009174225_3JrGhCFq.jpg"
							class="d-block carousel-image-custom" alt="Producto 3">
					</div>
				</div>
				<button class="carousel-control-prev" type="button" data-bs-target="#productCarousel"
					data-bs-slide="prev">
					<span class="carousel-control-prev-icon" aria-hidden="true"></span>
					<span class="visually-hidden">Previous</span>
				</button>
				<button class="carousel-control-next" type="button" data-bs-target="#productCarousel"
					data-bs-slide="next">
					<span class="carousel-control-next-icon" aria-hidden="true"></span>
					<span class="visually-hidden">Next</span>
				</button>
			</div>
		</section>
		<!-- Sección de Productos -->
		<section class="py-5">
			<div class="offcanvas offcanvas-start" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1"
				id="offcanvasScrolling" aria-labelledby="offcanvasScrollingLabel">
				<div class="offcanvas-header">
					<h5 class="offcanvas-title" id="offcanvasScrollingLabel">Filtros</h5>
					<button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
				</div>
				<div class="offcanvas-body">
					<div class="accordion accordion-flush" id="accordionFlushExample">
						<!-- Categorias -->
						<div class="accordion-item">
							<h2 class="accordion-header">
								<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
									data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true"
									aria-controls="panelsStayOpen-collapseOne">
									Categorias
								</button>
							</h2>
							<div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse px-4 py-2">
								<!--Cargadas por js -->
							</div>
						</div>
						<!-- Marcas -->
						<div class="accordion-item" style="display: none;">
							<h2 class="accordion-header">
								<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
									data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="true"
									aria-controls="panelsStayOpen-collapseTwo">
									Marcas
								</button>
							</h2>
							<div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse px-4 py-2">
								<div class="form-check">
									<input class="form-check-input" type="checkbox" value="samsung" id="samsung">
									<label class="form-check-label" for="samsung">
										Samsung
									</label>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="checkbox" value="apple" id="apple">
									<label class="form-check-label" for="apple">
										Apple
									</label>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="checkbox" value="lg" id="lg">
									<label class="form-check-label" for="lg">
										LG
									</label>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="checkbox" value="sony" id="sony">
									<label class="form-check-label" for="sony">
										Sony
									</label>
								</div>
								<div class="form-check">
									<input class="form-check-input" type="checkbox" value="Asus" id="asus">
									<label class="form-check-label" for="asus">
										Asus
									</label>
								</div>
							</div>
						</div>
						<!-- Precio -->
						<div class="accordion-item">
							<h2 class="accordion-header">
								<button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
									data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="true"
									aria-controls="panelsStayOpen-collapseThree">
									Precio
								</button>
							</h2>
							<div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse p-2">
								<div class="d-flex gap-2">
									<div class="input-group">
										<span class="input-group-text">$</span>
										<input type="text" class="form-control" aria-label="Precio minimo"
											placeholder="Minimo" id="minprice-input">
									</div>
									<div class="input-group">
										<span class="input-group-text">$</span>
										<input type="text" class="form-control" aria-label="Precio maximo"
											placeholder="Maximo" id="maxprice-input">
									</div>
								</div>
							</div>
						</div>
					</div>
					<!-- Boton de aplicar filtros -->
					<div class="d-grid gap-2 mt-4">
						<button class="btn btn-primary" type="button" id="apply-filters-button"
							onclick="obtenerFiltros()">
							Aplicar Filtros
						</button>
						<button class="btn btn-secondary" type="button" id="clear-filters-button"
							onclick="fetchProducts()">
							Limpiar Filtros
						</button>
					</div>
				</div>
			</div>
			<div class="container">
				<div class="mb-5 text-center">
					<h2 class="font-heading fs-7">Nuestros Productos</h2>
					<p class="text-secondary-dark">Explora nuestro catálogo de productos</p>
				</div>

				<button class="btn btn-primary mb-4" type="button" data-bs-toggle="offcanvas"
					data-bs-target="#offcanvasScrolling" aria-controls="offcanvasScrolling">
					Filtros
				</button>

				<div id="product-grid" class="row g-6 m-0">
					<!-- Las tarjetas de productos se insertarán aquí con JavaScript -->
				</div>
			</div>
		</section>
	</main>


	<!-- Placeholder para el footer reutilizable -->
	<div id="footer-placeholder"></div>

	<!-- Scripts -->
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"
		integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r"
		crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.min.js"
		integrity="sha384-G/EV+4j2dNv+tEPo3++6LCgdCROaejBqfUeNjuKAiuXbjrxilcCdDz6ZAVfHWe1Y"
		crossorigin="anonymous"></script>

	<script src="js/header.js"></script>
	<script src="js/cart.js"></script>
	<script src="js/footer.js"></script>
	<script src="js/burguer-button.js"></script>
	<script src="js/logout.js"></script>
	<script src="js/api.js"></script>
	<script>

		document.addEventListener('DOMContentLoaded', function () {
			// Comprueba si hay un término de búsqueda en la URL
			const urlParams = new URLSearchParams(window.location.search);
			const searchTerm = urlParams.get('search');
			const categoryId = urlParams.get('category_id');
			categroy();
			if (categoryId) {
				// Si hay un ID de categoría, filtramos por él
				filtrarProductos(categoryId, null, null);
			} else {
				// De lo contrario, hacemos una búsqueda normal o cargamos todos
				fetchProducts(searchTerm || '');
			}
		});
		async function categroy() {
			try {
				cats = await fetch(`${API_BASE_URL}/categorias/`)
				console.log(cats)
				const categoryGrid = document.getElementById('panelsStayOpen-collapseOne');
				categoryGrid.innerHTML = ''; // Limpiar el grid
				if (cats.ok) {
					const categorys = await cats.json();
				
				categorys.forEach(category => {
					const categoryCard = `
            <div class="form-check">
									<input class="form-check-input" type="radio" name="category" value="${category.id}" id="${category.name}-input">
									<label class="form-check-label" for="${category.name}-input">
										${category.name}
									</label>
								</div>
        `;
					categoryGrid.innerHTML += categoryCard;
				})}

			} catch (error) {
				console.error('Error de red:', error);
				categoryGrid.innerHTML = '<p class="text-center">Error de conexión. No se pudieron cargar las categorias.</p>';
			}
		}
	</script>
</body>

</html>