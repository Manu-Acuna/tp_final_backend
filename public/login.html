<html lang="en">
<head>
	<title>E-commerce</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&amp;display=swap" />
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Outfit:400,500,600,700,800,900&amp;subset=latin" />
	<link rel="stylesheet" href="css/bootstrap/bootstrap.min.css" />
	<link rel="icon" type="image/png" sizes="48x48" href="./favicon.png" />
	<link rel="stylesheet" href="css/styles.css">
	<script src="js/api.js"></script>
	<!-- burguer-button.js después de api.js para que encuentre los elementos del header -->
	<script src="js/header.js"></script>
	<script src="js/logout.js"></script>
	<script src="js/burguer-button.js"></script>
</head>

<body>
	<!-- Placeholder para el header reutilizable -->
    <div id="header-placeholder"></div>

	<section class="position-relative py-14 bg-white overflow-hidden">
		<div class="position-relative container" style="z-index:1;">
			<div class="mb-7 text-center mw-md mx-auto">
				<h2 class="font-heading mb-4 fs-7">Iniciar sesión</h2>
			</div>
			
			<!-- Formulario de inicio de sesión (Inputs: email, contraseña)-->
			<form class="mw-sm mx-auto" id="login-form"">
				<div class="mb-4 row g-6">
				<div class="col-12">
					<div class="form-group">
						<label class="mb-1 fw-medium text-light-dark" for="username">Email</label>
						<input class="form-control text-secondary-dark shadow" id="username" name="username" type="username" placeholder="juanperez@example.com"/>
					</div>
				</div>
				<div class="col-12">
					<div class="form-group">
						<label class="mb-1 fw-medium text-light-dark" for="contraseña">Contraseña</label>
						<input class="form-control text-secondary-dark shadow" id="contraseña" name="password" type="password" placeholder="********" required/>
					</div>
				</div>
				</div>
				<div class="mb-6 row align-items-center justify-content-between g-2">
				<div class="col-auto">
					<div class="form-check">
						<input class="form-check-input shadow" id="flexCheckDefault" type="checkbox" />
						<label class="form-check-label fs-13 fw-medium text-light-dark" for="flexCheckDefault">Recordarme</label>
					</div>
				</div>
				<div class="col-auto"><a class="fs-13 fw-medium text-success link-success" href="#">¿Olvidaste tu contraseña?</a></div>
				</div>
				<div class="mb-6 row">
				<div class="col-12">
					<button class="btn btn-lg btn-success fs-11 py-3 w-100 text-success-light shadow" type="submit">Iniciar sesión</button>
				</div>
				</div>
				<p class="mb-0 fs-13 fw-medium text-light-dark text-center"><span>¿No tienes una cuenta?</span>
					<a class="text-success link-success" href="register.html">Registrate</a>
				</p>
			</form>
			<!-- Formulario de inicio de sesión -->

		</div>
	</section>

	<!-- Placeholder para el footer reutilizable -->
    <div id="footer-placeholder"></div>

	<script>
		document.getElementById('login-form').addEventListener('submit', async function (event) {
			event.preventDefault();

			const formData = new FormData(this);
			// FastAPI con OAuth2PasswordRequestForm espera 'application/x-www-form-urlencoded'.
			// Creamos un objeto URLSearchParams para asegurar el formato correcto.
			const urlEncodedData = new URLSearchParams(formData);

			try {
				const response = await fetch('http://127.0.0.1:8000/token', {
					method: 'POST',
					body: formData,
					headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
					body: urlEncodedData,
				});

				if (response.ok) {
					const data = await response.json();
					// Guarda el token en localStorage para usarlo en futuras peticiones
					localStorage.setItem('accessToken', data.access_token);
					// alert('¡Inicio de sesión exitoso!');
					// Redirige a la página principal o al dashboard
					window.location.href = 'index.html'; 
				} else {
					const errorData = await response.json();
					alert('Error al iniciar sesión: ' + errorData.detail);
				}
			} catch (error) {
				console.error('Error:', error);
				alert('Ocurrió un error al intentar iniciar sesión.');
			}
		});
	</script>
	<script src="js/footer.js"></script>
</body>
</html>