<!DOCTYPE html>
<html lang="es">
<head>
	<title>E-commerce </title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<link rel="stylesheet"href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&amp;display=swap" />
	<link rel="stylesheet"href="https://fonts.googleapis.com/css?family=Outfit:400,500,600,700,800,900&amp;subset=latin" />
	<link rel="stylesheet" href="/css/bootstrap/bootstrap.min.css" />
	<link rel="icon" type="image/png" sizes="48x48" href="/favicon.png" />
	<style>
		/* Estilos para el contenedor lateral del carrito */
		#cart-sidebar {
			position: fixed;
			top: 0;
			right: -350px;
			/* Oculto por defecto */
			width: 350px;
			height: 100%;
			background-color: #f8f9fa;
			/* Color de fondo claro */
			box-shadow: -2px 0 5px rgba(0, 0, 0, 0.2);
			transition: right 0.3s ease-in-out;
			z-index: 1050;
			/* Asegura que esté por encima de otros elementos */
			overflow-y: auto;
			/* Permite scroll si el contenido es largo */
			padding: 20px;
			display: flex;
			flex-direction: column;
		}

		#cart-sidebar.open {
			right: 0;
			/* Visible */
		}

		#cart-sidebar-close {
			align-self: flex-end;
			/* Alinea el botón de cerrar a la derecha */
		}

		.card-img-to{height:40%}
		.card{height: 80vh}
		.card-body{height: 70%;}
		@media  only screen and (max-width: 600px){
			#producto-grid {
				display: flex !important;
			};
			#icons{ font-size: small;}
		}
	</style>
</head>

<body>
	<header><!--La Navbar se inserta por JavaScript--></header>
	<main><section class="overflow-hidden">
		<div class="d-none navbar-menu position-fixed top-0 end-0 bottom-0 w-75 mw-xs" style="z-index: 9999;">
			<div class="navbar-backdrop position-fixed top-0 start-0 end-0 bottom-0 bg-dark" style="opacity: 75%;">
			</div>
			<nav class="position-relative h-100 w-100 d-flex flex-column p-6 bg-white overflow-auto">
				<div class="d-flex align-items-center mb-5">
					<a class="me-auto h4 mb-0 text-decoration-none" href="#">
						<img class="img-fluid w-25" src="./images/logo.png" alt="" />
					</a>
					<a class="navbar-close text-secondary" href="#">
						<svg width="24" height="24" viewbox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
							<path d="M6 18L18 6M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"
								stroke-linejoin="round"></path>
						</svg>
					</a>
				</div>
				<div id="navbar-burger-buttons" class="row align-items-center g-6">
					<!-- Los botones del menú burguer se insertarán aquí -->
				</div>
			</nav>
		</div>
	</section>

	<!-- Contenedor lateral del carrito -->
	<div id="cart-sidebar">
		<button id="cart-sidebar-close" class="btn btn-sm btn-outline-secondary mb-3">
			<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-lg"
				viewBox="0 0 16 16">
				<path d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8z" />
			</svg>
		</button>
		<h4 class="mb-4">Mi Carrito</h4>
		<div id="cart-items-container" class="flex-grow-1">
			<!-- Los items del carrito se cargarán aquí -->
			<p class="text-muted">Cargando carrito...</p>
		</div>
		<div id="cart-total" class="mt-4 pt-3 border-top">
			<!-- El total del carrito se mostrará aquí -->
		</div>
	</div>

	<!-- Sección de Productos -->
	<section class="py-5">
		<div class="container">
			<div id="producto-grid" class="row g-6">
				<!-- Las tarjetas de productos se insertarán aquí con JavaScript -->
			</div>
		</div>
	</section>
	</main>
	<footer></footer>
	<script src="js/burguer-button.js"></script><script src="js/api.js"></script><script src="js/logout.js"></script>
	<script>
		var id = location.search.substr(4)
		document.addEventListener('DOMContentLoaded', function () {
			updateNavbar();
			updateBurgerMenu();
			fetchproductid();
		});
		//sobreescribe para no tener problema
		function fetchProducts(){};
		// la función se ejecuta después del insertar a html por js así que funciona igual
		function logout() {
			localStorage.removeItem('accessToken');
			updateNavbar();
			updateBurgerMenu();
			fetchCartDetails(); // Limpia la vista del carrito
		}
		async function fetchproductid() {
			try {
				const response = await fetch('/productos/'+id);
				if (response.ok) {
					const producto = await response.json();
					renderproductid(producto);
				} else {
					console.error('Error al obtener el producto:', await response.text());
					document.getElementById('producto-grid').innerHTML = '<p class="text-center">No se pudo cargar el producto.</p>';
				}
			} catch (error) {
				console.error('Error de red:', error);
				document.getElementById('producto-grid').innerHTML = '<p class="text-center">Error de conexión. No se pudo cargar el producto.</p>';
			}
		}

		function renderproductid(product) {
			const productoGrid = document.getElementById('producto-grid');
			productoGrid.innerHTML = ''; // Limpiar el grid
			if (product.length === 0) {
				productoGrid.innerHTML = '<p class="text-center">Este producto no esta disponible en este momento.</p>';
				return;
			}
			productoGrid.style.height="80vh"
			productoGrid.style.display="grid"
				const productoCard = `
							<img src="${product.image_url || `https://via.placeholder.com/300x200.png?text=Imagen+no+disponible`}" class="" alt="${product.name}" style="width: 100%; height: 500px; object-fit: contain;grid-column:1/2">
							<div class="d-flex flex-column "style="grid-column:2/2">
								<h5 class="">${product.name}</h5>
								<p class=" text-secondary-dark mb-auto"style="">${product.description || 'Sin descripción.'}</p>
								<div style="padding-left:20px" class="">
									<span style="margin: 0 3px" class="fs-8 fw-bold ">$${product.price.toFixed(2)}</span>
									<button style="background:blue; padding:4px;color:white" class="btn" onclick="addToCart(${product.id})" ${product.stock === 0 ? 'disabled' : ''}>
										<svg style="width:40px;"xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" viewBox="0 0 16 16"><path d="M0 1.5A.5.5 0 0 1 .5 1H2a.5.5 0 0 1 .485.379L2.89 3H14.5a.5.5 0 0 1 .491.592l-1.5 8A.5.5 0 0 1 13 12H4a.5.5 0 0 1-.491-.408L2.01 3.607 1.61 2H.5a.5.5 0 0 1-.5-.5M3.102 4l1.313 7h8.17l1.313-7zM5 12a2 2 0 1 0 0 4 2 2 0 0 0 0-4m7 0a2 2 0 1 0 0 4 2 2 0 0 0 0-4m-7 1a1 1 0 1 1 0 2 1 1 0 0 1 0-2m7 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/></svg>
									</button>
									<div style="margin: 0 3px; font-size:small">Cantidad disponible:${product.stock}</div>
									<p style="margin: 0 3px; color:grey; font-size:small">Precio s/imp. nac. $${(Number(product.price) * 0.85).toFixed(2)}</p>
								</div>
							<section class="row">
            <div id="icons">
                <div class="container-item">
                    <span class="icon-container">
                        <svg style="max-height:30px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M512 176C520.8 176 528 183.2 528 192L528 224L112 224L112 192C112 183.2 119.2 176 128 176L512 176zM528 288L528 448C528 456.8 520.8 464 512 464L128 464C119.2 464 112 456.8 112 448L112 288L528 288zM128 128C92.7 128 64 156.7 64 192L64 448C64 483.3 92.7 512 128 512L512 512C547.3 512 576 483.3 576 448L576 192C576 156.7 547.3 128 512 128L128 128zM144 408C144 421.3 154.7 432 168 432L216 432C229.3 432 240 421.3 240 408C240 394.7 229.3 384 216 384L168 384C154.7 384 144 394.7 144 408zM288 408C288 421.3 298.7 432 312 432L376 432C389.3 432 400 421.3 400 408C400 394.7 389.3 384 376 384L312 384C298.7 384 288 394.7 288 408z"/></svg>
                    </span>
                        <span class="text-container">Hasta 12 cuotas abonando con tarjetas de crédito</span>
                </div>
                <div class="container-item">
                    <span class="icon-container">
                        <svg style="max-height:30px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M96 144C87.2 144 80 151.2 80 160L80 448C80 456.8 87.2 464 96 464L99.3 464C109.7 427.1 143.7 400 184 400C224.3 400 258.2 427.1 268.7 464L371.3 464C376.2 446.6 386.4 431.3 400 420.1L400 160C400 151.2 392.8 144 384 144L96 144zM99.3 512L96 512C60.7 512 32 483.3 32 448L32 160C32 124.7 60.7 96 96 96L384 96C419.3 96 448 124.7 448 160L448 192L503.4 192C520.4 192 536.7 198.7 548.7 210.7L589.3 251.3C601.3 263.3 608 279.6 608 296.6L608 448C608 483.3 579.3 512 544 512L540.7 512C530.3 548.9 496.3 576 456 576C415.7 576 381.8 548.9 371.3 512L268.7 512C258.3 548.9 224.3 576 184 576C143.7 576 109.8 548.9 99.3 512zM448 320L560 320L560 296.6C560 292.4 558.3 288.3 555.3 285.3L514.7 244.7C511.7 241.7 507.6 240 503.4 240L448 240L448 320zM448 368L448 400.4C450.6 400.2 453.3 400 456 400C496.3 400 530.2 427.1 540.7 464L544 464C552.8 464 560 456.8 560 448L560 368L448 368zM184 528C206.1 528 224 510.1 224 488C224 465.9 206.1 448 184 448C161.9 448 144 465.9 144 488C144 510.1 161.9 528 184 528zM456 528C478.1 528 496 510.1 496 488C496 465.9 478.1 448 456 448C433.9 448 416 465.9 416 488C416 510.1 433.9 528 456 528z"/></svg>
                    </span>
                        <span class="text-container">Envío a todo el país a través de OCA</span>
                </div>
                <div class="container-item">
                    <span class="icon-container">
                        <svg style="max-height:30px" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 640"><!--!Font Awesome Free v7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free Copyright 2025 Fonticons, Inc.--><path d="M320 64C324.6 64 329.2 65 333.4 66.9L521.8 146.8C543.8 156.1 560.2 177.8 560.1 204C559.6 303.2 518.8 484.7 346.5 567.2C329.8 575.2 310.4 575.2 293.7 567.2C121.3 484.7 80.6 303.2 80.1 204C80 177.8 96.4 156.1 118.4 146.8L306.7 66.9C310.9 65 315.4 64 320 64z"/></svg>
                    </span>
                        <span class="text-container">Este producto cuenta con garantía de 36 meses.</span>
                </div>
            </div>
        </section>
							</div>
					</div>
				`;
				productoGrid.innerHTML += productoCard;
		}
	</script>
</body>
</html>