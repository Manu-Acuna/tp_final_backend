<!DOCTYPE html>
<html lang="es">
<head>
	<title>E-commerce </title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
	<link rel="stylesheet"href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&amp;display=swap" />
	<link rel="stylesheet"href="https://fonts.googleapis.com/css?family=Outfit:400,500,600,700,800,900&amp;subset=latin" />
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="css/styles.css" />
	<link rel="icon" type="image/png" sizes="48x48" href="./favicon.png" />
	<style>
		.product-image {
			max-height: 500px;
			object-fit: contain;
		}
	</style>
</head>

<body>
	<!-- Placeholder para el header reutilizable -->
    <div id="header-placeholder"></div>

	<!-- Placeholder para el carrito reutilizable -->
    <div id="cart-placeholder"></div>

	<main class="py-5">
		<!-- Sección de Productos -->
		<div class="container">
			<div id="producto-container" class="row">
				<!-- El detalle del producto se insertará aquí con JavaScript -->
				<div class="col-12 text-center">
					<div class="spinner-border text-primary" role="status">
						<span class="visually-hidden">Cargando...</span>
					</div>
					<p class="mt-2 text-muted">Cargando producto...</p>
				</div>
			</div>
		</div>
	</main>
	<!-- Placeholder para el footer reutilizable -->
    <div id="footer-placeholder"></div>

	<script src="js/burguer-button.js"></script>
	<script src="js/api.js"></script>
	<script src="js/logout.js"></script>
	<script src="js/header.js"></script>
	<script src="js/cart.js"></script>
	<script src="js/footer.js"></script>
	
	<script>
		document.addEventListener('DOMContentLoaded', function () {
			// initApp() se llama desde header.js, que se encarga de todo lo relacionado al header.
			fetchProductById();
		});

		async function fetchProductById() {
			const container = document.getElementById('producto-container');
			const urlParams = new URLSearchParams(window.location.search);
			const productId = urlParams.get('id');

			if (!productId) {
				container.innerHTML = '<p class="text-center alert alert-danger">No se especificó un ID de producto.</p>';
				return;
			}

			try {
				// Usamos la URL base de la API definida en api.js
				const response = await fetch(`${API_BASE_URL}/productos/${productId}`);
				if (response.ok) {
					const producto = await response.json();
					renderProductDetail(producto);
				} else {
					console.error('Error al obtener el producto:', await response.text());
					container.innerHTML = '<p class="text-center alert alert-warning">No se pudo cargar el producto.</p>';
				}
			} catch (error) {
				console.error('Error de red:', error);
				container.innerHTML = '<p class="text-center alert alert-danger">Error de conexión. No se pudo cargar el producto.</p>';
			}
		}

		function renderProductDetail(product) {
			const container = document.getElementById('producto-container');
			container.innerHTML = ''; // Limpiar el contenedor

			const productHtml = `
				<!-- Columna de la Imagen -->
				<div class="col-lg-6 mb-4 mb-lg-0">
					<div class="card border-0">
						<img src="${product.image_url || 'https://via.placeholder.com/500'}" class="img-fluid rounded product-image" alt="${product.name}">
					</div>
				</div>

				<!-- Columna de la Información -->
				<div class="col-lg-6">
					<div class="ps-lg-4">
						<h2 class="fw-bold mb-3">${product.name}</h2>
						<p class="text-muted mb-4">${product.description || 'Sin descripción.'}</p>
						
						<div class="d-flex align-items-center mb-4">
							<div class="me-3">
								<span class="h3 fw-bold mb-0">${formatPrice(product.price)}</span>
								<p class="mb-0" style="color:grey; font-size:small;">Precio s/imp. nac. ${formatPrice(Number(product.price) * 0.85)}</p>
							</div>
							<span class="badge ${product.stock > 0 ? 'bg-success' : 'bg-danger'} ms-auto">${product.stock > 0 ? `Stock: ${product.stock}` : 'Sin stock'}</span>
						</div>

						<button class="btn btn-primary btn-lg w-100" onclick="addToCart(${product.id})" ${product.stock === 0 ? 'disabled' : ''}>
							${product.stock > 0 ? 'Añadir al carrito' : 'Sin stock'}
						</button>

						<hr class="my-4">

						<div class="d-flex flex-column gap-3">
							<div class="d-flex align-items-center">
								<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-credit-card me-3 text-primary" viewBox="0 0 16 16"><path d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2zm2-1a1 1 0 0 0-1 1v1h14V4a1 1 0 0 0-1-1zM1 11a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V6H1z"/><path d="M4 8a1 1 0 0 1 1-1h1a1 1 0 0 1 1 1v1a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1z"/></svg>
								<span>Hasta 12 cuotas con tarjetas de crédito.</span>
							</div>
							<div class="d-flex align-items-center">
								<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-truck me-3 text-primary" viewBox="0 0 16 16"><path d="M0 3.5A1.5 1.5 0 0 1 1.5 2h9A1.5 1.5 0 0 1 12 3.5V5h1.02a1.5 1.5 0 0 1 1.17.563l1.481 1.85a1.5 1.5 0 0 1 .329.938V10.5a1.5 1.5 0 0 1-1.5 1.5H14a2 2 0 1 1-4 0H5a2 2 0 1 1-4 0a1.5 1.5 0 0 1-1.5-1.5zM12 11a1 1 0 1 0 0 2 1 1 0 0 0 0-2m-7 1a1 1 0 1 0 0-2 1 1 0 0 0 0 2M1.5 3a.5.5 0 0 0-.5.5V5h9V3.5a.5.5 0 0 0-.5-.5zM13 5.5a.5.5 0 0 0 .5.5h.02a.5.5 0 0 0 .48-.438l1.48-1.85a.5.5 0 0 0-.329-.938H13.5v2.5z"/></svg>
								<span>Envío a todo el país.</span>
							</div>
							<div class="d-flex align-items-center">
								<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-shield-check me-3 text-primary" viewBox="0 0 16 16"><path d="M5.338 1.59a61 61 0 0 0-2.837.856.48.48 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.7 10.7 0 0 0 2.287 2.233c.346.244.642.44.912.603.268.162.53.293.793.398.263.105.527.162.79.162h.001c.263 0 .527-.057.79-.162.263-.105.525-.236.793-.398.27-.163.566-.36.912-.603a10.7 10.7 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.523zM13.82 3.79a50 50 0 0 1 .487.122c.487.158.904.346 1.146.54c.271.22.326.59.109.884-1.857 2.482-3.58 4.8-5.63 6.657-2.05 1.857-4.04 2.6-5.63 2.6-1.59 0-3.582-.743-5.63-2.6C.54 10.28 1.818 7.246 2.374 3.09c.027-.2.19-.35.39-.403.242-.066.658-.21 1.146-.415a50 50 0 0 1 .487-.122C5.314 2.04 6.55 1.807 8 1.807s2.686.234 3.82.483z"/><path d="M10.854 5.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 7.793l2.646-2.647a.5.5 0 0 1 .708 0z"/></svg>
								<span>Este producto cuenta con garantía de 36 meses.</span>
							</div>
						</div>
					</div>
				</div>
			`;
			container.innerHTML = productHtml;
		}
	</script>
</body>
</html>